# æ™ºèƒ½å·¡æ£€ç³»ç»Ÿ - å®Œæ•´ç›®å½•ç»“æ„

## é¡¹ç›®æ ¹ç›®å½•

```
RaspiCartServer/
â”‚
â”œâ”€â”€ ğŸ“ api_server/                    # BentoML APIæœåŠ¡
â”‚   â”œâ”€â”€ service.py                   # æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ loader.py                    # å¤„ç†å™¨åŠ è½½å™¨
â”‚   â”œâ”€â”€ base_project.py              # åŸºç¡€é¡¹ç›®ç±»
â”‚   â”œâ”€â”€ config.yaml                  # æœåŠ¡é…ç½®
â”‚   â”œâ”€â”€ utils.py                     # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ start_server.py              # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start_server.bat             # Windowså¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start_server.sh              # Linuxå¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ test_service.py              # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ æ¶æ„è¯´æ˜.md                   # æ¶æ„æ–‡æ¡£
â”‚   â””â”€â”€ processors/                  # ä»»åŠ¡å¤„ç†å™¨
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ task1_pointer_reader/    # ä»»åŠ¡1: æŒ‡é’ˆä»ªè¡¨
â”‚       â”‚   â””â”€â”€ processor.py
â”‚       â”œâ”€â”€ task2_temperature/       # ä»»åŠ¡2: æ¸©åº¦æ£€æµ‹
â”‚       â”‚   â””â”€â”€ processor.py
â”‚       â”œâ”€â”€ task3_smoke_a/          # ä»»åŠ¡3: çƒŸé›¾ç›‘æµ‹A
â”‚       â”‚   â””â”€â”€ processor.py
â”‚       â””â”€â”€ task4_smoke_b/          # ä»»åŠ¡4: çƒŸé›¾ç›‘æµ‹B
â”‚           â””â”€â”€ processor.py
â”‚
â”œâ”€â”€ ğŸ“ web_frontend/                  # Flask WebæœåŠ¡ â­ æ–°å¢
â”‚   â”œâ”€â”€ app.py                       # Flaskä¸»åº”ç”¨
â”‚   â”œâ”€â”€ start_web.py                 # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start_web.bat                # Windowså¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start_web.sh                 # Linuxå¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ test_web_service.py          # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ README.md                    # WebæœåŠ¡è¯´æ˜
â”‚   â”œâ”€â”€ static/                      # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”‚   â””â”€â”€ style.css           # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”‚   â”œâ”€â”€ main.js             # ä¸»è„šæœ¬
â”‚   â”‚   â”‚   â”œâ”€â”€ websocket.js        # WebSocketç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ charts.js           # å›¾è¡¨ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ task_manager.js     # ä»»åŠ¡ç®¡ç†
â”‚   â”‚   â””â”€â”€ audio/                  # éŸ³æ•ˆæ–‡ä»¶(å¯é€‰)
â”‚   â”‚       â””â”€â”€ .gitkeep
â”‚   â””â”€â”€ templates/                   # HTMLæ¨¡æ¿
â”‚       â””â”€â”€ index.html              # ä¸»é¡µé¢
â”‚
â”œâ”€â”€ ğŸ“ scripts/                       # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ db_manager.py                # æ•°æ®åº“ç®¡ç†å™¨
â”‚   â”œâ”€â”€ init_database.py             # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â””â”€â”€ test_database.py             # æ•°æ®åº“æµ‹è¯•
â”‚
â”œâ”€â”€ ğŸ“ data/                          # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ database/                    # æ•°æ®åº“æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ inspection.db           # SQLiteæ•°æ®åº“
â”‚   â”œâ”€â”€ images/                      # å›¾ç‰‡å­˜å‚¨
â”‚   â”‚   â””â”€â”€ YYYY-MM-DD/             # æŒ‰æ—¥æœŸåˆ†ç±»
â”‚   â”‚       â”œâ”€â”€ task1/              # æŒ‰ä»»åŠ¡ç±»å‹åˆ†ç±»
â”‚   â”‚       â”œâ”€â”€ task2/
â”‚   â”‚       â”œâ”€â”€ task3/
â”‚   â”‚       â””â”€â”€ task4/
â”‚   â”œâ”€â”€ logs/                        # æ—¥å¿—æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ bentoml.log             # APIæœåŠ¡æ—¥å¿—
â”‚   â”‚   â””â”€â”€ flask.log               # WebæœåŠ¡æ—¥å¿—
â”‚   â””â”€â”€ config/                      # é…ç½®æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ venv/                          # Pythonè™šæ‹Ÿç¯å¢ƒ
â”‚
â”œâ”€â”€ ğŸ“„ requirements.txt               # Pythonä¾èµ–
â”œâ”€â”€ ğŸ“„ .env                          # ç¯å¢ƒå˜é‡(éœ€åˆ›å»º)
â”œâ”€â”€ ğŸ“„ env.example                   # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ ğŸ“„ README.md                     # é¡¹ç›®è¯´æ˜
â”‚
â”œâ”€â”€ ğŸ“„ æ™ºèƒ½å·¡æ£€æœåŠ¡ç«¯éœ€æ±‚æ–‡æ¡£.md        # æ€»éœ€æ±‚æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ æ™ºèƒ½å·¡æ£€æœåŠ¡ç«¯éœ€æ±‚æ–‡æ¡£-æœåŠ¡ç«¯.md # æœåŠ¡ç«¯éœ€æ±‚
â”œâ”€â”€ ğŸ“„ æ™ºèƒ½å·¡æ£€æœåŠ¡ç«¯éœ€æ±‚æ–‡æ¡£-å°è½¦ç«¯.md # å°è½¦ç«¯éœ€æ±‚
â”œâ”€â”€ ğŸ“„ æ™ºèƒ½è½¦è½¯ä»¶æ¶æ„.md               # è½¯ä»¶æ¶æ„è¯´æ˜
â”œâ”€â”€ ğŸ“„ å¿«é€Ÿå¼€å§‹æŒ‡å—.md                 # å¿«é€Ÿå¼€å§‹
â””â”€â”€ ğŸ“„ WebæœåŠ¡å¿«é€Ÿå¯åŠ¨æŒ‡å—.md         # WebæœåŠ¡æŒ‡å— â­ æ–°å¢
```

## æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### APIæœåŠ¡(BentoML)

| æ–‡ä»¶ | è¯´æ˜ | ä½œç”¨ |
|------|------|------|
| `api_server/service.py` | æœåŠ¡å…¥å£ | ç»Ÿä¸€è·¯ç”± /api/process |
| `api_server/loader.py` | å¤„ç†å™¨åŠ è½½å™¨ | åŠ¨æ€åŠ è½½ä»»åŠ¡å¤„ç†å™¨ |
| `api_server/processors/task*/processor.py` | ä»»åŠ¡å¤„ç†å™¨ | å¤„ç†å„ç±»å‹ä»»åŠ¡ |

### WebæœåŠ¡(Flask)

| æ–‡ä»¶ | è¯´æ˜ | ä½œç”¨ |
|------|------|------|
| `web_frontend/app.py` | Flaskä¸»åº”ç”¨ | æä¾›APIå’ŒWebSocket |
| `web_frontend/templates/index.html` | ä¸»é¡µé¢ | ç®¡ç†ç•Œé¢ |
| `web_frontend/static/css/style.css` | æ ·å¼æ–‡ä»¶ | ç•Œé¢ç¾åŒ– |
| `web_frontend/static/js/*.js` | JavaScript | å‰ç«¯é€»è¾‘ |

### æ•°æ®åº“

| æ–‡ä»¶ | è¯´æ˜ | ä½œç”¨ |
|------|------|------|
| `scripts/db_manager.py` | æ•°æ®åº“ç®¡ç†å™¨ | å°è£…æ•°æ®åº“æ“ä½œ |
| `scripts/init_database.py` | åˆå§‹åŒ–è„šæœ¬ | åˆ›å»ºæ•°æ®åº“å’Œè¡¨ |
| `data/database/inspection.db` | SQLiteæ•°æ®åº“ | å­˜å‚¨æ‰€æœ‰æ•°æ® |

## æœåŠ¡æ¶æ„

```
                    æµè§ˆå™¨ (ç”¨æˆ·)
                        â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Flask WebæœåŠ¡      â”‚
              â”‚  ç«¯å£: 5000        â”‚
              â”‚  - REST API        â”‚
              â”‚  - WebSocket       â”‚
              â”‚  - é™æ€é¡µé¢        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  SQLiteæ•°æ®åº“       â”‚
              â”‚  - task_records    â”‚
              â”‚  - task_queue      â”‚
              â”‚  - alert_log       â”‚
              â”‚  - cart_status     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†‘
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  BentoML APIæœåŠ¡    â”‚
              â”‚  ç«¯å£: 3000        â”‚
              â”‚  - ä»»åŠ¡å¤„ç†å™¨1-4    â”‚
              â”‚  - DashScopeè°ƒç”¨   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†‘
                   æ ‘è“æ´¾å°è½¦
```

## æ•°æ®æµå‘

### ä»»åŠ¡æµç¨‹
1. **Webç®¡ç†** â†’ æ·»åŠ ä»»åŠ¡åˆ°æ•°æ®åº“
2. **å°è½¦æŸ¥è¯¢** â†’ GET /api/tasks (Flask)
3. **å°è½¦æ‰§è¡Œ** â†’ é‡‡é›†å›¾ç‰‡
4. **å›¾ç‰‡ä¸Šä¼ ** â†’ POST /api/process (BentoML)
5. **AIè¯†åˆ«** â†’ DashScopeå¤„ç†
6. **ç»“æœè¿”å›** â†’ ä¿å­˜æ•°æ®åº“
7. **å®æ—¶æ¨é€** â†’ WebSocketé€šçŸ¥å‰ç«¯
8. **ç•Œé¢æ›´æ–°** â†’ å›¾è¡¨å’Œå›¾ç‰‡åˆ·æ–°

### ç›‘æ§æµç¨‹
1. **å®æ—¶è¿æ¥** â†’ WebSocketä¿æŒè¿æ¥
2. **çŠ¶æ€æ›´æ–°** â†’ å°è½¦çŠ¶æ€æ¨é€
3. **æŠ¥è­¦è§¦å‘** â†’ å¼‚å¸¸æƒ…å†µé€šçŸ¥
4. **æ—¥å¿—è®°å½•** â†’ ç³»ç»Ÿäº‹ä»¶è¿½è¸ª

## ç«¯å£åˆ†é…

| æœåŠ¡ | ç«¯å£ | åè®® | è¯´æ˜ |
|------|------|------|------|
| Flask Web | 5000 | HTTP/WebSocket | Webç®¡ç†ç•Œé¢ |
| BentoML API | 3000 | HTTP | å›¾ç‰‡å¤„ç†æœåŠ¡ |

## å¯åŠ¨é¡ºåº

1. **ç¬¬ä¸€æ­¥**: å¯åŠ¨BentoML APIæœåŠ¡ (ç«¯å£3000)
   ```bash
   cd api_server
   bentoml serve service.py --port 3000
   ```

2. **ç¬¬äºŒæ­¥**: å¯åŠ¨Flask WebæœåŠ¡ (ç«¯å£5000)
   ```bash
   cd web_frontend
   python start_web.py
   ```

3. **ç¬¬ä¸‰æ­¥**: æµè§ˆå™¨è®¿é—®ç®¡ç†ç•Œé¢
   ```
   http://localhost:5000
   ```

4. **ç¬¬å››æ­¥**: å°è½¦è¿æ¥å¹¶å¼€å§‹æ‰§è¡Œä»»åŠ¡

## å…³é”®æŠ€æœ¯æ ˆ

### åç«¯
- **BentoML 1.4.28** - APIæœåŠ¡æ¡†æ¶
- **Flask 3.0.0** - Webæ¡†æ¶
- **Flask-SocketIO 5.3.5** - WebSocketå®æ—¶é€šä¿¡
- **SQLite** - è½»é‡çº§æ•°æ®åº“
- **OpenAI SDK** - DashScope APIè°ƒç”¨

### å‰ç«¯
- **HTML5 + CSS3** - é¡µé¢ç»“æ„å’Œæ ·å¼
- **JavaScript (ES6+)** - äº¤äº’é€»è¾‘
- **ECharts 5.4.3** - æ•°æ®å¯è§†åŒ–
- **Socket.IO 4.5.4** - WebSocketå®¢æˆ·ç«¯

### æ•°æ®åº“è¡¨
- `task_records` - ä»»åŠ¡è®°å½•è¡¨
- `task_queue` - ä»»åŠ¡é˜Ÿåˆ—è¡¨
- `alert_log` - æŠ¥è­¦æ—¥å¿—è¡¨
- `cart_status` - å°è½¦çŠ¶æ€è¡¨

## å¼€å‘å»ºè®®

### æ·»åŠ æ–°ä»»åŠ¡ç±»å‹
1. åœ¨ `api_server/processors/` åˆ›å»ºæ–°ç›®å½•
2. å®ç° `processor.py` æ–‡ä»¶
3. åœ¨å‰ç«¯æ·»åŠ å¯¹åº”é¢æ¿
4. æ›´æ–°æ•°æ®åº“æŸ¥è¯¢é€»è¾‘

### ä¿®æ”¹ç•Œé¢
1. æ ·å¼: `web_frontend/static/css/style.css`
2. å¸ƒå±€: `web_frontend/templates/index.html`
3. é€»è¾‘: `web_frontend/static/js/*.js`

### æ‰©å±•API
1. åç«¯è·¯ç”±: `web_frontend/app.py`
2. æ•°æ®åº“æ“ä½œ: `scripts/db_manager.py`
3. å‰ç«¯è°ƒç”¨: `web_frontend/static/js/task_manager.js`

## éƒ¨ç½²æ¸…å•

- [x] Python 3.10/3.11 ç¯å¢ƒ
- [x] è™šæ‹Ÿç¯å¢ƒåˆ›å»º
- [x] ä¾èµ–åŒ…å®‰è£…
- [x] æ•°æ®åº“åˆå§‹åŒ–
- [x] .env æ–‡ä»¶é…ç½®
- [x] é˜²ç«å¢™ç«¯å£å¼€æ”¾
- [x] BentoML APIæœåŠ¡
- [x] Flask WebæœåŠ¡
- [x] æµè§ˆå™¨æµ‹è¯•è®¿é—®

## è¿ç»´å»ºè®®

1. **å®šæœŸå¤‡ä»½**
   - æ•°æ®åº“æ–‡ä»¶: `data/database/inspection.db`
   - é…ç½®æ–‡ä»¶: `.env`

2. **æ—¥å¿—ç›‘æ§**
   - APIæ—¥å¿—: `data/logs/bentoml.log`
   - Webæ—¥å¿—: `data/logs/flask.log`

3. **ç£ç›˜æ¸…ç†**
   - å›¾ç‰‡ä¿ç•™30å¤©
   - æ—¥å¿—ä¿ç•™7å¤©
   - æ•°æ®åº“è®°å½•ä¿ç•™90å¤©

4. **æ€§èƒ½ç›‘æ§**
   - CPUä½¿ç”¨ç‡
   - å†…å­˜ä½¿ç”¨ç‡
   - ç£ç›˜ç©ºé—´
   - ç½‘ç»œå»¶è¿Ÿ

---

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2024-11-21

