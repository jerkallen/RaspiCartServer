# æ™ºèƒ½å·¡æ£€ç³»ç»Ÿ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ“‹ å‰ç½®è¦æ±‚

- Python 3.10 æˆ– 3.11
- å·²å®‰è£…è™šæ‹Ÿç¯å¢ƒï¼ˆvenvå·²åˆ›å»ºï¼‰
- é˜¿é‡Œäº‘ç™¾ç‚¼APIå¯†é’¥ï¼ˆDashScopeï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ5åˆ†é’Ÿéƒ¨ç½²ï¼‰

### æ­¥éª¤1: å®‰è£…ä¾èµ–åŒ…

```bash
# Windows
.\venv\Scripts\activate
pip install -r requirements.txt

# Linux/Mac
source venv/bin/activate
pip install -r requirements.txt
```

### æ­¥éª¤2: é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š

```bash
# Windows
copy env.example .env

# Linux/Mac
cp env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„é˜¿é‡Œäº‘APIå¯†é’¥ï¼š

```bash
DASHSCOPE_API_KEY=sk-ä½ çš„å®é™…å¯†é’¥
```

### æ­¥éª¤3: å¯åŠ¨BentoMLæœåŠ¡

#### Windows:
```bash
cd api_server
start_server.bat
```

#### Linux/Mac:
```bash
cd api_server
chmod +x start_server.sh
./start_server.sh
```

#### æˆ–è€…æ‰‹åŠ¨å¯åŠ¨:
```bash
cd api_server
python start_server.py serve
```

æœåŠ¡å°†åœ¨ **http://0.0.0.0:3000** å¯åŠ¨ã€‚

### æ­¥éª¤4: æµ‹è¯•æœåŠ¡

**æ–¹æ³•1: æµè§ˆå™¨è®¿é—®å¥åº·æ£€æŸ¥**

æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:3000/health

**æ–¹æ³•2: ä½¿ç”¨curlæµ‹è¯•**

```bash
curl http://localhost:3000/health
```

**æ–¹æ³•3: è¿è¡Œæµ‹è¯•è„šæœ¬**

```bash
cd api_server
python test_service.py
```

## ğŸ“¡ APIä½¿ç”¨ç¤ºä¾‹

### å¥åº·æ£€æŸ¥

```bash
curl http://localhost:3000/health
```

å“åº”:
```json
{
    "status": "healthy",
    "service": "inspection_api_service",
    "processors": ["task1_pointer_reader", "task2_temperature", "task3_smoke_a", "task4_smoke_b"],
    "timestamp": "2024-11-21 14:30:00"
}
```

### ä»»åŠ¡1: æŒ‡é’ˆä»ªè¡¨è¯»æ•°

```bash
curl -X POST http://localhost:3000/api/process \
  -F "image=@test_image.jpg" \
  -F "task_type=1" \
  -F "station_id=3"
```

### ä»»åŠ¡2: é«˜æ¸©ç‰©ä½“æ£€æµ‹

```bash
curl -X POST http://localhost:3000/api/process \
  -F "image=@thermal_image.jpg" \
  -F "task_type=2" \
  -F "station_id=5" \
  -F 'params={"max_temperature":75.5,"avg_temperature":45.2,"ambient_temperature":25.0}'
```

### ä»»åŠ¡3: çƒŸé›¾åˆ¤æ–­A

```bash
curl -X POST http://localhost:3000/api/process \
  -F "image=@smoke_image.jpg" \
  -F "task_type=3" \
  -F "station_id=7"
```

### ä»»åŠ¡4: çƒŸé›¾åˆ¤æ–­B

```bash
curl -X POST http://localhost:3000/api/process \
  -F "image=@smoke_image.jpg" \
  -F "task_type=4" \
  -F "station_id=8"
```

## ğŸ“‚ é¡¹ç›®ç»“æ„è¯´æ˜

```
RaspiCartServer/
â”œâ”€â”€ api_server/              # BentoML APIæœåŠ¡ï¼ˆä¸»è¦å·¥ä½œç›®å½•ï¼‰
â”‚   â”œâ”€â”€ service.py           # æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ config.yaml          # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ base_project.py      # åŸºç±»å®šä¹‰
â”‚   â”œâ”€â”€ loader.py            # åŠ¨æ€åŠ è½½å™¨
â”‚   â”œâ”€â”€ utils.py             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ processors/          # 4ä¸ªä»»åŠ¡å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ task1_pointer_reader/
â”‚   â”‚   â”œâ”€â”€ task2_temperature/
â”‚   â”‚   â”œâ”€â”€ task3_smoke_a/
â”‚   â”‚   â””â”€â”€ task4_smoke_b/
â”‚   â”œâ”€â”€ start_server.py      # Pythonå¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start_server.bat     # Windowså¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start_server.sh      # Linux/Macå¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ test_service.py      # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ data/                    # æ•°æ®å­˜å‚¨ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ images/              # ä¸Šä¼ çš„å›¾ç‰‡
â”‚   â”œâ”€â”€ logs/                # æ—¥å¿—æ–‡ä»¶
â”‚   â”œâ”€â”€ database/            # æ•°æ®åº“ï¼ˆæœªæ¥ä½¿ç”¨ï¼‰
â”‚   â””â”€â”€ config/              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt         # Pythonä¾èµ–
â”œâ”€â”€ .env                     # ç¯å¢ƒå˜é‡ï¼ˆéœ€åˆ›å»ºï¼‰
â”œâ”€â”€ env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ README.md                # é¡¹ç›®è¯´æ˜
```

## ğŸ” å¸¸è§é—®é¢˜

### Q1: å¯åŠ¨æ—¶æç¤ºæ‰¾ä¸åˆ°æ¨¡å—

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¡®ä¿æ¿€æ´»äº†è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\activate  # Windows
source venv/bin/activate # Linux/Mac

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### Q2: å¯åŠ¨æ—¶æç¤º DASHSCOPE_API_KEY æœªè®¾ç½®

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­æ˜¯å¦æ­£ç¡®è®¾ç½®äº† `DASHSCOPE_API_KEY`
- ç¡®ä¿ `.env` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•

### Q3: è°ƒç”¨APIæ—¶è¿”å›é”™è¯¯

**å¯èƒ½åŸå› **:
1. å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒï¼ˆåªæ”¯æŒJPEG/PNGï¼‰
2. å›¾ç‰‡å¤ªå¤§ï¼ˆé™åˆ¶10MBï¼‰
3. task_typeæˆ–station_idå‚æ•°ç¼ºå¤±
4. DashScope APIå¯†é’¥æ— æ•ˆæˆ–é¢åº¦ä¸è¶³

**æ£€æŸ¥æ–¹æ³•**:
```bash
# æŸ¥çœ‹æ—¥å¿—
tail -f data/logs/bentoml.log
```

### Q4: æœåŠ¡å¯åŠ¨æˆåŠŸä½†æ— æ³•è®¿é—®

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº†3000ç«¯å£
- å°è¯•è®¿é—® http://127.0.0.1:3000/health è€Œä¸æ˜¯ localhost
- æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨: `netstat -ano | findstr 3000` (Windows)

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **å¯åŠ¨æ—¶é—´**: ~5ç§’
- **å•æ¬¡è¯·æ±‚å“åº”æ—¶é—´**:
  - ä»»åŠ¡1ï¼ˆæŒ‡é’ˆè¯»æ•°ï¼‰: 2-5ç§’
  - ä»»åŠ¡2ï¼ˆæ¸©åº¦æ£€æµ‹ï¼‰: <1ç§’ï¼ˆæœ¬åœ°å¤„ç†ï¼‰
  - ä»»åŠ¡3/4ï¼ˆçƒŸé›¾åˆ¤æ–­ï¼‰: 2-5ç§’
- **å¹¶å‘èƒ½åŠ›**: æœ€å¤š200ä¸ªå¹¶å‘è¿æ¥
- **è¶…æ—¶è®¾ç½®**: 300ç§’

## ğŸ”§ é«˜çº§é…ç½®

### ä¿®æ”¹ç«¯å£

ç¼–è¾‘ `api_server/config.yaml`:

```yaml
server:
  port: 3000  # æ”¹ä¸ºä½ æƒ³è¦çš„ç«¯å£
```

### è°ƒæ•´å¹¶å‘æ•°

ç¼–è¾‘ `api_server/config.yaml`:

```yaml
server:
  workers: 4              # Workerè¿›ç¨‹æ•°
  limit_concurrency: 200  # æœ€å¤§å¹¶å‘è¿æ¥æ•°
```

### ç¦ç”¨æŸä¸ªä»»åŠ¡å¤„ç†å™¨

ç¼–è¾‘ `api_server/config.yaml`:

```yaml
projects:
  - name: task1_pointer_reader
    enabled: false  # è®¾ä¸ºfalseç¦ç”¨
```

## ğŸ“ æ—¥å¿—æŸ¥çœ‹

æ—¥å¿—æ–‡ä»¶ä½ç½®: `data/logs/bentoml.log`

å®æ—¶æŸ¥çœ‹æ—¥å¿—:

```bash
# Windows (PowerShell)
Get-Content data\logs\bentoml.log -Wait

# Linux/Mac
tail -f data/logs/bentoml.log
```

## ğŸ› ï¸ å¼€å‘æ¨¡å¼

å¦‚æœä½ éœ€è¦ä¿®æ”¹ä»£ç ï¼š

1. ä¿®æ”¹ä»£ç åï¼Œé‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆ
2. ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œä¹Ÿéœ€è¦é‡å¯æœåŠ¡
3. æ·»åŠ æ–°çš„ä»»åŠ¡å¤„ç†å™¨ï¼Œå‚è€ƒ `api_server/æ¶æ„è¯´æ˜.md`

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£: `README.md`
- æ¶æ„è¯´æ˜: `api_server/æ¶æ„è¯´æ˜.md`
- éœ€æ±‚æ–‡æ¡£: `æ™ºèƒ½å·¡æ£€æœåŠ¡ç«¯éœ€æ±‚æ–‡æ¡£-æœåŠ¡ç«¯.md`

## ğŸ¯ ä¸‹ä¸€æ­¥

- éƒ¨ç½²Webç®¡ç†ç•Œé¢ï¼ˆFlaskæœåŠ¡ï¼‰
- é…ç½®æ•°æ®åº“ï¼ˆSQLiteï¼‰
- å®ç°WebSocketå®æ—¶æ¨é€
- é›†æˆå°è½¦ç«¯ç¨‹åº

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€

