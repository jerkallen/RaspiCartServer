# Flask WebæœåŠ¡ - æ™ºèƒ½å·¡æ£€ç³»ç»Ÿ

## åŠŸèƒ½è¯´æ˜

Flask WebæœåŠ¡æä¾›ä»¥ä¸‹åŠŸèƒ½:

1. **Webç®¡ç†ç•Œé¢** - ç°ä»£åŒ–çš„å¯è§†åŒ–ç®¡ç†ç•Œé¢
2. **ä»»åŠ¡ç®¡ç†API** - RESTful APIæ¥å£
3. **WebSocketå®æ—¶é€šä¿¡** - å®æ—¶æ•°æ®æ¨é€
4. **å†å²æ•°æ®æŸ¥è¯¢** - æ•°æ®åº“æŸ¥è¯¢å’Œç»Ÿè®¡

## ç›®å½•ç»“æ„

```
web_frontend/
â”œâ”€â”€ app.py                 # Flaskä¸»åº”ç”¨
â”œâ”€â”€ start_web.py          # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ start_web.bat         # Windowså¯åŠ¨è„šæœ¬
â”œâ”€â”€ start_web.sh          # Linuxå¯åŠ¨è„šæœ¬
â”œâ”€â”€ static/               # é™æ€èµ„æº
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css    # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ main.js      # ä¸»è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ websocket.js # WebSocketç®¡ç†
â”‚   â”‚   â”œâ”€â”€ charts.js    # å›¾è¡¨ç®¡ç†
â”‚   â”‚   â””â”€â”€ task_manager.js # ä»»åŠ¡ç®¡ç†
â”‚   â””â”€â”€ audio/           # éŸ³æ•ˆæ–‡ä»¶(å¯é€‰)
â”œâ”€â”€ templates/           # HTMLæ¨¡æ¿
â”‚   â””â”€â”€ index.html      # ä¸»é¡µé¢
â””â”€â”€ README.md           # æœ¬æ–‡æ¡£
```

## å¿«é€Ÿå¯åŠ¨

### Windows

åŒå‡»è¿è¡Œ `start_web.bat` æˆ–åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ:

```bash
start_web.bat
```

### Linux/Mac

```bash
chmod +x start_web.sh
./start_web.sh
```

### æ‰‹åŠ¨å¯åŠ¨

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
cd ..
venv\Scripts\activate    # Windows
source venv/bin/activate # Linux/Mac

# åˆ‡æ¢ç›®å½•
cd web_frontend

# å¯åŠ¨æœåŠ¡
python start_web.py
```

## è®¿é—®åœ°å€

å¯åŠ¨æˆåŠŸå,åœ¨æµè§ˆå™¨è®¿é—®:

```
http://localhost:5000
```

æˆ–ä½¿ç”¨æœåŠ¡å™¨IP:

```
http://æœåŠ¡å™¨IP:5000
```

## APIæ¥å£è¯´æ˜

### 1. ä»»åŠ¡ç®¡ç†

#### è·å–ä»»åŠ¡åˆ—è¡¨
- **æ¥å£**: `GET /api/tasks`
- **å“åº”**: è¿”å›æ‰€æœ‰å¾…å¤„ç†ä»»åŠ¡

#### æ·»åŠ ä»»åŠ¡
- **æ¥å£**: `POST /api/tasks/add`
- **å‚æ•°**:
  ```json
  {
    "station_id": 1,
    "task_type": 1,
    "priority": "medium",
    "params": {}
  }
  ```

#### åˆ é™¤ä»»åŠ¡
- **æ¥å£**: `DELETE /api/tasks/{task_id}`

#### æ¸…ç©ºå·²å®Œæˆä»»åŠ¡
- **æ¥å£**: `POST /api/tasks/clear`

### 2. å†å²æ•°æ®

#### æŸ¥è¯¢å†å²è®°å½•
- **æ¥å£**: `GET /api/history`
- **å‚æ•°**:
  - task_type: ä»»åŠ¡ç±»å‹(å¯é€‰)
  - station_id: ç«™ç‚¹ID(å¯é€‰)
  - start_date: å¼€å§‹æ—¥æœŸ(å¯é€‰)
  - end_date: ç»“æŸæ—¥æœŸ(å¯é€‰)
  - limit: è¿”å›æ¡æ•°(é»˜è®¤50)
  - offset: åç§»é‡(é»˜è®¤0)

### 3. ç³»ç»ŸçŠ¶æ€

#### è·å–ç»Ÿè®¡ä¿¡æ¯
- **æ¥å£**: `GET /api/statistics`

#### è·å–å°è½¦çŠ¶æ€
- **æ¥å£**: `GET /api/cart/status`

#### è·å–æŠ¥è­¦ä¿¡æ¯
- **æ¥å£**: `GET /api/alerts`

### 4. å›¾ç‰‡è®¿é—®

- **æ¥å£**: `GET /images/{path}`
- **ç¤ºä¾‹**: `http://localhost:5000/images/2024-11-21/task1/station01_143005.jpg`

## WebSocketäº‹ä»¶

### å®¢æˆ·ç«¯æ¥æ”¶äº‹ä»¶

1. **connected** - è¿æ¥æˆåŠŸ
2. **task_result** - ä»»åŠ¡ç»“æœæ¨é€
3. **task_queue_update** - ä»»åŠ¡é˜Ÿåˆ—æ›´æ–°
4. **cart_status** - å°è½¦çŠ¶æ€æ›´æ–°
5. **alert** - æŠ¥è­¦æ¨é€
6. **pong** - å¿ƒè·³å“åº”

### å®¢æˆ·ç«¯å‘é€äº‹ä»¶

1. **ping** - å‘é€å¿ƒè·³

## ç•Œé¢åŠŸèƒ½

### ä¾§è¾¹æ 

1. **ä»»åŠ¡ç®¡ç†** - æ·»åŠ æ–°ä»»åŠ¡,è®¾ç½®å‚æ•°
2. **ä»»åŠ¡é˜Ÿåˆ—** - æŸ¥çœ‹å’Œç®¡ç†å¾…å¤„ç†ä»»åŠ¡
3. **å°è½¦çŠ¶æ€** - å®æ—¶æ˜¾ç¤ºå°è½¦ä¿¡æ¯
4. **ç³»ç»Ÿæ—¥å¿—** - æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œæ—¥å¿—
5. **ç³»ç»Ÿç»Ÿè®¡** - æ˜¾ç¤ºç»Ÿè®¡æ•°æ®

### ä¸»æ˜¾ç¤ºåŒº(ç”°å­—æ ¼å¸ƒå±€)

- **ä»»åŠ¡1é¢æ¿**: æŒ‡é’ˆä»ªè¡¨è¯»æ•°
- **ä»»åŠ¡2é¢æ¿**: æ¸©åº¦æ£€æµ‹æ•°æ®
- **ä»»åŠ¡3é¢æ¿**: çƒŸé›¾ç›‘æµ‹A
- **ä»»åŠ¡4é¢æ¿**: çƒŸé›¾ç›‘æµ‹B

æ¯ä¸ªé¢æ¿åŒ…å«:
- ğŸ“ˆ å†å²æ•°æ®å›¾è¡¨(ECharts)
- ğŸ”¢ æœ€æ–°æ•°æ®æ˜¾ç¤º
- ğŸ–¼ï¸ æœ€æ–°å›¾ç‰‡æ˜¾ç¤º
- âš™ï¸ æ“ä½œæŒ‰é’®

## æŠ€æœ¯æ ˆ

- **åç«¯**: Flask 3.0.0
- **WebSocket**: Flask-SocketIO 5.3.5
- **å‰ç«¯**: HTML5 + CSS3 + JavaScript(ES6+)
- **å›¾è¡¨**: ECharts 5.4.3
- **å®æ—¶é€šä¿¡**: Socket.IO 4.5.4

## é…ç½®è¯´æ˜

### app.pyé…ç½®é¡¹

```python
# å¯†é’¥é…ç½®
app.config['SECRET_KEY'] = 'your-secret-key'

# æ–‡ä»¶ä¸Šä¼ é™åˆ¶
app.config['MAX_CONTENT_LENGTH'] = 10 * 1024 * 1024  # 10MB

# WebSocketé…ç½®
socketio = SocketIO(app, cors_allowed_origins="*", 
                   ping_timeout=60, ping_interval=25)
```

### ç«¯å£é…ç½®

é»˜è®¤ç«¯å£: `5000`

å¦‚éœ€ä¿®æ”¹,ç¼–è¾‘ `start_web.py`:

```python
socketio.run(app, host='0.0.0.0', port=5000)
```

## å¸¸è§é—®é¢˜

### 1. ç«¯å£è¢«å ç”¨

ä¿®æ”¹ `start_web.py` ä¸­çš„ç«¯å£å·,æˆ–å…³é—­å ç”¨5000ç«¯å£çš„ç¨‹åºã€‚

### 2. WebSocketè¿æ¥å¤±è´¥

æ£€æŸ¥é˜²ç«å¢™è®¾ç½®,ç¡®ä¿5000ç«¯å£å¯è®¿é—®ã€‚

### 3. å›¾ç‰‡æ— æ³•æ˜¾ç¤º

æ£€æŸ¥å›¾ç‰‡è·¯å¾„é…ç½®,ç¡®ä¿ `data/images/` ç›®å½•å­˜åœ¨ä¸”æœ‰è¯»å–æƒé™ã€‚

### 4. æ•°æ®åº“è¿æ¥å¤±è´¥

è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬:

```bash
python scripts/init_database.py
```

## å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„APIæ¥å£

åœ¨ `app.py` ä¸­æ·»åŠ è·¯ç”±:

```python
@app.route('/api/your-endpoint', methods=['GET', 'POST'])
def your_endpoint():
    # å®ç°é€»è¾‘
    return jsonify({"status": "success"})
```

### æ·»åŠ æ–°çš„WebSocketäº‹ä»¶

```python
@socketio.on('your_event')
def handle_your_event(data):
    # å¤„ç†é€»è¾‘
    emit('response_event', data)
```

### ä¿®æ”¹é¡µé¢æ ·å¼

ç¼–è¾‘ `static/css/style.css` æ–‡ä»¶ã€‚

### æ·»åŠ æ–°çš„JavaScriptåŠŸèƒ½

åœ¨ `static/js/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„JSæ–‡ä»¶,å¹¶åœ¨ `index.html` ä¸­å¼•å…¥ã€‚

## æ—¥å¿—è¯´æ˜

æ—¥å¿—æ–‡ä»¶ä½ç½®: `../data/logs/flask.log`

æ—¥å¿—çº§åˆ«:
- INFO: å¸¸è§„ä¿¡æ¯
- WARNING: è­¦å‘Šä¿¡æ¯
- ERROR: é”™è¯¯ä¿¡æ¯

## ç»´æŠ¤å»ºè®®

1. å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
2. ç›‘æ§æ—¥å¿—æ–‡ä»¶å¤§å°
3. å®šæœŸæ¸…ç†è¿‡æœŸå›¾ç‰‡å’Œæ—¥å¿—
4. æ›´æ–°ä¾èµ–åŒ…ç‰ˆæœ¬

## æ›´æ–°è®°å½•

- 2024-11-21: åˆå§‹ç‰ˆæœ¬å‘å¸ƒ

