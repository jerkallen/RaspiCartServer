# 智能巡检系统BentoML API服务配置文件

server:
  host: "0.0.0.0"
  port: 3000
  workers: 4
  timeout: 300                    # 请求处理超时（秒）
  
  # HTTP Keep-Alive 连接优化
  keepalive_timeout: 60           # Keep-Alive 连接空闲超时（秒）
  max_keepalive_connections: 100  # 最大 Keep-Alive 连接数
  limit_concurrency: 200          # 最大并发连接数

# SSL/HTTPS 配置（如需要）
ssl:
  enabled: false
  certfile: "certs/server.crt"
  keyfile: "certs/server.key"

logging:
  level: "INFO"
  format: "json"

# 任务处理器配置
projects:
  # 任务1: 指针仪表读数
  - name: task1_pointer_reader
    enabled: true
    description: "指针式仪表读数识别"
    project_path: "processors/task1_pointer_reader"
    params:
      model: "qwen-vl-plus"
  
  # 任务2: 高温物体检测
  - name: task2_temperature
    enabled: true
    description: "高温物体检测"
    project_path: "processors/task2_temperature"
    params:
      warning_threshold: 60.0
      danger_threshold: 80.0
  
  # 任务3: 烟雾判断A
  - name: task3_smoke_a
    enabled: true
    description: "烟雾判断A"
    project_path: "processors/task3_smoke_a"
    params:
      model: "qwen-vl-plus"
  
  # 任务4: 烟雾判断B
  - name: task4_smoke_b
    enabled: true
    description: "烟雾判断B"
    project_path: "processors/task4_smoke_b"
    params:
      model: "qwen-vl-plus"
  
  # 任务5: 物品描述
  - name: task5_object_description
    enabled: true
    description: "物品描述识别"
    project_path: "processors/task5_object_description"
    params:
      model: "qwen-vl-plus"

# 全局限制
limits:
  max_image_size: 10485760      # 10MB
  max_images_per_request: 10
  max_request_size: 52428800    # 50MB

# 大模型提示词配置
prompts:
  # 任务1: 指针仪表读数
  task1_pointer_reader: |
    请读取这个指针式仪表的数值。

    分析步骤：
    1. 识别表盘的量程范围（最小值到最大值）
    2. 识别表盘的刻度间隔
    3. 确定指针的精确位置
    4. 计算读数（保留2位小数）

    返回格式（纯JSON，无其他文字）：
    {
        "value": 读数值,
        "unit": "单位（如MPa、℃等）",
        "min_range": 最小刻度,
        "max_range": 最大刻度,
        "confidence": 置信度(0-1),
        "status": "normal/warning/danger"
    }

    注意：如果指针不清晰或表盘损坏，confidence设为低值并在status中标注warning

  # 任务3: 烟雾判断A
  task3_smoke_a: |
    请分析图片内容，判断其中是否存在烟雾。

    烟雾定义：包括但不限于
    - 燃烧产生的黑烟、白烟
    - 蒸汽、水雾
    - 工业排放的烟气
    - 任何悬浮在空气中的烟雾状物质

    分析要点：
    1. 是否有明显的烟雾形态
    2. 烟雾的密度（轻微/中等/严重）
    3. 烟雾的颜色和分布范围
    4. 排除误判（如云、雾霾等自然现象需根据场景判断）

    返回格式（纯JSON，无其他文字）：
    {
        "has_smoke": true或false,
        "smoke_type": "combustion/steam/fog/none",
        "density": "light/medium/heavy/none",
        "confidence": 置信度(0-1),
        "description": "简短描述"
    }

  # 任务4: 烟雾判断B
  task4_smoke_b: |
    请分析图片内容，判断其中是否存在烟雾。

    烟雾定义：包括但不限于
    - 燃烧产生的黑烟、白烟
    - 蒸汽、水雾
    - 工业排放的烟气
    - 任何悬浮在空气中的烟雾状物质

    分析要点：
    1. 是否有明显的烟雾形态
    2. 烟雾的密度（轻微/中等/严重）
    3. 烟雾的颜色和分布范围
    4. 排除误判（如云、雾霾等自然现象需根据场景判断）

    返回格式（纯JSON，无其他文字）：
    {
        "has_smoke": true或false,
        "smoke_type": "combustion/steam/fog/none",
        "density": "light/medium/heavy/none",
        "confidence": 置信度(0-1),
        "description": "简短描述"
    }

  # 任务5: 物品描述
  task5_object_description: |
    请分析图片中A4纸上放置的物品，并提供简要描述。

    分析要点：
    1. 识别A4纸上放置的所有物品
    2. 描述物品的类型、颜色、大小等特征
    3. 判断物品的摆放状态（整齐/凌乱）
    4. 如果有多个物品，列出所有物品

    返回格式（纯JSON，无其他文字）：
    {
        "description": "简要描述A4纸上的物品情况",
        "items": ["物品1", "物品2", ...],
        "item_count": 物品数量,
        "arrangement": "neat/messy/normal",
        "confidence": 置信度(0-1),
        "status": "normal"
    }

    注意：如果图片中没有清晰的A4纸或物品不清晰，confidence设为低值

  # 意图解析服务提示词
  intent_parser:
    system: "你是一个智能巡检系统的任务解析助手。你的职责是理解用户的检查需求，并将其转换为具体的任务列表。"
    user_template: |
      请分析用户的检查需求，并返回需要执行的任务列表。

      系统支持的任务类型：
      1. 任务1 - 指针仪表读数（站点1）：检查指针式压力表的读数
      2. 任务2 - 温度检测（站点2）：检测高温物体
      3. 任务3 - 烟雾监测A（站点3）：监测烟雾情况
      4. 任务4 - 烟雾监测B（站点4）：监测烟雾情况
      5. 任务5 - 物品描述（站点5）：识别和描述物品

      用户输入："{user_input}"

      请理解用户意图，提取需要执行的任务。例如：
      - "检查压力表和温度" -> 任务1和任务2
      - "检查站点1和站点5" -> 任务1和任务5
      - "全部检查一遍" -> 全部5个任务
      - "烟雾检测" -> 任务3和任务4

      请严格按照以下JSON格式返回，不要添加任何其他内容：
      {
        "tasks": [
          {"task_type": 1, "station_id": 1},
          {"task_type": 2, "station_id": 2}
        ]
      }

